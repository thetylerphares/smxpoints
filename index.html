<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AMA Supercross Standings</title>

  <style>
    :root {
      --row-h: 48px;
      --rows-visible: 4;
      --bg: #000;
      --card: #111;
      --border: #222;
      --text: #fff;
      --muted: rgba(255,255,255,0.55);
      --pts: #4CAF50;
    }

    body {
      margin: 0;
      padding: 18px;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 14px;
      border: 1px solid #151515;
      display: flex;
      flex-direction: column;
    }

    .cardHeader {
      position: sticky;
      top: 0;
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px;
      z-index: 5;
    }

    h2 {
      margin: 0;
      text-align: center;
      font-size: 23px;
    }

    .colHeader {
      display: grid;
      grid-template-columns: 40px 1fr 70px;
      font-size: 12px;
      color: var(--muted);
    }

    .colHeader div:last-child {
      text-align: right;
    }

    .viewport {
      height: calc(var(--row-h) * var(--rows-visible));
      overflow: hidden;
      margin-top: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    tr {
      height: var(--row-h);
    }

    td {
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
      font-size: 19px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    td.rank {
      width: 40px;
      padding-left: 4px;
      opacity: 0.75;
    }

    td.name {
      padding-left: 8px;
    }

    td.pts {
      width: 70px;
      text-align: right;
      font-size: 21px;
      font-weight: bold;
      color: var(--pts);
      padding-right: 4px;
    }

    .logo {
      height: 18px;
      margin-right: 6px;
      vertical-align: middle;
    }

    .updated {
      margin-top: 8px;
      text-align: center;
      font-size: 12px;
      opacity: 0.55;
    }

    .scroller {
      transition: transform 600ms ease;
    }
  </style>
</head>
<body>

<div class="grid">

  <div class="card">
    <div class="cardHeader">
      <h2>450SX</h2>
      <div class="colHeader">
        <div>#</div><div>Rider</div><div>PTS</div>
      </div>
    </div>
    <div class="viewport">
      <div id="c450" class="scroller"></div>
    </div>
    <div id="u450" class="updated"></div>
  </div>

  <div class="card">
    <div class="cardHeader">
      <h2>250 West</h2>
      <div class="colHeader">
        <div>#</div><div>Rider</div><div>PTS</div>
      </div>
    </div>
    <div class="viewport">
      <div id="c250w" class="scroller"></div>
    </div>
    <div id="u250w" class="updated"></div>
  </div>

  <div class="card">
    <div class="cardHeader">
      <h2>250 East</h2>
      <div class="colHeader">
        <div>#</div><div>Rider</div><div>PTS</div>
      </div>
    </div>
    <div class="viewport">
      <div id="c250e" class="scroller"></div>
    </div>
    <div id="u250e" class="updated"></div>
  </div>

</div>

<script>
const BASE = "https://smxstanding.tylerphares.workers.dev";

const ROW_H = 48;
const VISIBLE = 4;
const MAX_DISPLAY = 20;   // ðŸ”¥ TOP 20 ONLY
const STEP_MS = 2200;
const PAUSE_MS = 1600;

const state = {
  "450":  { idx:0, timer:null, el:"c450", upd:"u450", count:0 },
  "250w": { idx:0, timer:null, el:"c250w", upd:"u250w", count:0 },
  "250e": { idx:0, timer:null, el:"c250e", upd:"u250e", count:0 }
};

function buildRows(list) {
  return `
    <table>
      <tbody>
        ${list.map(r=>`
          <tr>
            <td class="rank">${r.rank}</td>
            <td class="name">
              ${r.logo ? `<img src="${r.logo}" class="logo">` : ""}
              ${r.name}
            </td>
            <td class="pts">${r.points}</td>
          </tr>
        `).join("")}
      </tbody>
    </table>
  `;
}

function stopScroll(cls){
  if(state[cls].timer) clearInterval(state[cls].timer);
}

function startScroll(cls){
  const s = state[cls];
  stopScroll(cls);

  const el = document.getElementById(s.el);

  if(s.count <= VISIBLE) return;

  s.idx = 0;

  s.timer = setInterval(()=>{
    const maxStart = s.count - VISIBLE;

    if(s.idx < maxStart){
      s.idx++;
      el.style.transform = `translateY(${-s.idx * ROW_H}px)`;
    } else {
      stopScroll(cls);
      setTimeout(()=>{
        el.style.transition="none";
        el.style.transform="translateY(0px)";
        s.idx=0;
        requestAnimationFrame(()=>{
          requestAnimationFrame(()=>{
            el.style.transition="transform 600ms ease";
            startScroll(cls);
          });
        });
      }, PAUSE_MS);
    }

  }, STEP_MS);
}

async function render(cls){
  const s = state[cls];

  try{
    const res = await fetch(`${BASE}/?class=${cls}`, {cache:"no-store"});
    const data = await res.json();

    let list = data.standings || [];

    // sort just in case
    list.sort((a,b)=>b.points - a.points);
    list.forEach((r,i)=>r.rank=i+1);

    // ðŸ”¥ limit to top 20
    list = list.slice(0, MAX_DISPLAY);

    document.getElementById(s.el).innerHTML = buildRows(list);
    document.getElementById(s.upd).textContent =
      `Updated: ${new Date(data.updatedAt).toLocaleString()}`;

    s.count = list.length;
    startScroll(cls);

  }catch{
    document.getElementById(s.el).innerHTML =
      "<div style='padding:10px;color:red;text-align:center;'>Load Error</div>";
  }
}

function loadAll(){
  render("450");
  render("250w");
  render("250e");
}

loadAll();
setInterval(loadAll, 10*60*1000);

</script>

</body>
</html>
